<% @page_title = "おかず一覧" %>
<h1><%= @page_title %></h1>
<% @limit= params[:box].to_i %>
<% @souzai = [] %>

<% if @dishes.present? %>
  <table class="list">
    <thead>
      <tr>
        <th>画像</th>
        <th>おすすめ</th>
        <th>おかず名</th>
        <th>カロリー</th>
      </tr>
    </thead>
    <tbody>
      <% @dishes.each do |dish| %>
        <% @souzai.push(dish.dish_name.to_s) %>
      <div class="dish">
        <tr>
          <td>
            <% if dish.dish_picture.attached? %>
              <%= image_tag dish.dish_picture.variant(resize: "50x50") %>
            <% else %>
              <%= image_tag("noimage.png", size: "50x50", alt: "noimage") %>
            <% end %>
          </td>
          <% if dish.recommend == true then %>
            <td><%= image_tag("good.png", size: "20x20", alt: "good") %></td>
          <% else %>
            <td><%= image_tag("mu.png", size: "20x20", alt: "nogood") %></td>
          <% end %>
          <td style="text-align: right"><%= link_to dish.dish_name, dish %></td>
          <td><%= dish.dish_kcal %></td>
          <td>
            <%= link_to "編集", [:edit, dish] %>
            <%= link_to "削除", dish, method: :delete,
              data: { confirm: "本当に削除しますか?" } %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>

  <% if @limit!=0 %>
    <%= form_tag(sub_dishes_path, method: "get") do %>
      <% for i in 1..@limit %>
        選択<%= "#{i}" %>: <%= select_tag :dish, options_for_select(@souzai), multiple: true %>
      <% end %>
      <%= submit_tag "送信"%>
    <% end %>
  <% else %>
    <%= link_to "サイドメニューへ", :sub_dishes %>
    <h1>お弁当を食べたい人は箱を先に選んでネ!</h1>
  <% end %>
<% else %>
  <p>おかず情報がありません</p>
      </div>
<% end %>